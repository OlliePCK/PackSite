# Nginx Proxy Configuration for thepck.com
# Add this to your Nginx Proxy Manager custom location settings
# 
# In Nginx Proxy Manager:
# 1. Edit your thepck.com proxy host
# 2. Go to "Custom locations" tab
# 3. Add these locations:

# ============================================
# Location 1: API Proxy
# ============================================
# Location: /api
# Scheme: http
# Forward Hostname/IP: packbot  (or the container name)
# Forward Port: 3001
# 
# Custom Nginx Configuration (in Advanced tab):
location /api {
    proxy_pass http://packbot:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_cache_bypass $http_upgrade;
}

# ============================================
# Location 2: Socket.IO WebSocket Proxy  
# ============================================
# Location: /socket.io
# Scheme: http
# Forward Hostname/IP: packbot
# Forward Port: 3001
#
# Custom Nginx Configuration:
location /socket.io {
    proxy_pass http://packbot:3001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 86400;
}

# ============================================
# ALTERNATIVE: If using nginx.conf directly
# ============================================
# Add this server block or merge with existing:

server {
    listen 80;
    listen 443 ssl http2;
    server_name thepck.com;

    # SSL config managed by Cloudflare/NPM
    
    # Static files (your website)
    root /config/www/the-pack;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy to PackBot container
    location /api {
        proxy_pass http://packbot:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # Socket.IO WebSocket proxy
    location /socket.io {
        proxy_pass http://packbot:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400;
    }
}

# ============================================
# NOTES:
# ============================================
# 
# 1. Replace "packbot" with your actual container name if different
#    You can find it with: docker ps | grep -i pack
#
# 2. Both containers must be on the same Docker network (laserproxy)
#    Verify with: docker network inspect laserproxy
#
# 3. The PackBot container exposes port 3001 internally
#    No need to map it to host since nginx is on same network
#
# 4. For Unraid, you may need to add the network in the 
#    container template under "Extra Parameters":
#    --network=laserproxy
#
# 5. Test connectivity from nginx container:
#    docker exec -it binhex-nginx ping packbot
#    docker exec -it binhex-nginx curl http://packbot:3001/api/status
